<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>librespeaker: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">librespeaker
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">librespeaker Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>librespeaker</code> is an audio processing library which can perform noise suppression, direction of arrival calculation, beamforming, hotword searching. It reads the microphoone stream from linux sound server, e.g. PulseAudio. It exposes a few APIs which enable users to get indicated when hotword is said and the processed microphone data in PCM format, which then can be sent to cloud services like Alexa for further processing.</p>
<p>From the top view, <code>librespeaker</code> has two parts:</p><ul>
<li>Audio processing (filter) chain</li>
<li>A supervisor which manages the chain, getting events and outputs from the chain, this supervisor is implemented by the <code>ReSpeaker</code> class.</li>
</ul>
<h2>Audio processing chain</h2>
<p>Namely the chain consists of several nodes which link together in a user specified order. A node can be considered as a blackbox which has input and output, and internally applies filter algorithms to the audio stream passing through. The input / output is a <code>block</code> of audio data, which is specified by some parameters. See <a class="el" href="structrespeaker_1_1NodeParameter.html">respeaker::NodeParameter</a>. Please note that some nodes may accept particular length of block, e.g. the <a class="el" href="classrespeaker_1_1VepAecBeamformingNode.html">respeaker::VepAecBeamformingNode</a> accepts only 8 milliseconds block, this is decided by the algorithms. Generally users don't need to specially care about these restrictions, as we utilized the nodes into another application - named <code>respeakerd</code>, which is a typicall server application for the ReSpeaker v2 hardware with tuned configurations.</p>
<p>The list of nodes:</p><ul>
<li><a class="el" href="classrespeaker_1_1PulseCollectorNode.html">respeaker::PulseCollectorNode</a> - collect the audio data from PulseAudio</li>
<li><a class="el" href="classrespeaker_1_1SelectorNode.html">respeaker::SelectorNode</a> - select specified channels from the input stream, and output with same rate and format.</li>
<li><a class="el" href="classrespeaker_1_1VepAecBeamformingNode.html">respeaker::VepAecBeamformingNode</a> - do beamforming and AEC (acoustic echo cancellation)</li>
<li><a class="el" href="classrespeaker_1_1VepDoaKwsNode.html">respeaker::VepDoaKwsNode</a> - do DoA (direction of arrival) and keyword search (hotword triggering)</li>
<li><a class="el" href="classrespeaker_1_1HybridNode.html">respeaker::HybridNode</a> - do hybrid algorithms to the input stream, including NS (noise suppression), AGC (automatic gain control), etc...</li>
<li>may have more in the future</li>
</ul>
<p>Each node inherits from one or more interface classes:</p><ul>
<li><a class="el" href="classrespeaker_1_1BaseNode.html">respeaker::BaseNode</a> - defines the basic behaviours of a node, including fetch/process/store data block, thread start /stop, etc...</li>
<li><a class="el" href="classrespeaker_1_1DirectionReporterNode.html">respeaker::DirectionReporterNode</a> - defines an interface of getting DoA result</li>
<li><a class="el" href="classrespeaker_1_1HotwordDetectionNode.html">respeaker::HotwordDetectionNode</a> - defines an interface of getting hotword trigger event</li>
</ul>
<p>The nodes are linked together by calling the <code>Uplink</code> method, please see the examples to know how to link up.</p>
<p>There's a data structure shared between all the nodes of the chain - <a class="el" href="structrespeaker_1_1ChainSharedData.html">respeaker::ChainSharedData</a>. This structure is used to pass status through the chain, the status are:</p><ul>
<li>bool exit_flag - a flag to indicate that all the threads in the chain should exit immediately</li>
<li>ChainState state - the state of the chain, please see <a class="el" href="namespacerespeaker.html#a5372a69a95f6fd5424740ce4157651d9">respeaker::ChainState</a></li>
<li>bool vad_node_present - to indicate if there's a node with ability to detect voice activity in the chain</li>
<li>bool vad - if the last processed block of the node who can do Vad contains active voice</li>
</ul>
<p>The items in this shared structure are partially used by internal, part of them are exposed to APIs for users to call, with the supervisor methods.</p>
<h2>Supervisor - the <code>ReSpeaker</code> class</h2>
<p>After creation of the chain, we need to register the chain into a supervisor - <a class="el" href="classrespeaker_1_1ReSpeaker.html">respeaker::ReSpeaker</a>. The supervisor exposes the methods to user calls. Users don't need to directly operate the nodes then. This is done by registering the following node pointers:</p><ul>
<li>The pointer of the head node</li>
<li>The pointer of the output node - The chain may have branches, saying the chain may have more than one tails, so it's necessary to tell the supervisor which tail is to output the processed audio stream.</li>
<li>The pointer of the node which does DoA</li>
<li>The pointer of the node which can output the event of hotword triggering</li>
</ul>
<p>After all these done, we have a topological graph like this (this is an exmaple):</p>
<div class="fragment"><div class="line">+--------------+         +---------------+         +-----------+</div><div class="line">|collector node| +-----&gt; |processing node+-------&gt; |output node|</div><div class="line">+------+-------+ |       +---------------+         +-----+-----+</div><div class="line">       |         |                       |               |</div><div class="line">       |         |       +------------+  |               |</div><div class="line">       |         +-----&gt; |event node  |  |               |</div><div class="line">       |                 +------+-----+  |               |</div><div class="line">       |                        |        |               |</div><div class="line">       |                        |        |               |</div><div class="line">+------v------------------------v--------v---------------v-----+</div><div class="line">|                         supervisor                           |</div><div class="line">+--------------------------------------------------------------+</div></div><!-- fragment --><p>Then we call the <code>Start</code> method of the supervisor to start the threads and processing, and call other methods like <code>DetectHotword</code> or <code>Listen</code> to get the outputs. Please see <a class="el" href="classrespeaker_1_1ReSpeaker.html">respeaker::ReSpeaker</a> to know the methods it provides.</p>
<h2>Next Step</h2>
<p>Please briefly see each class's methods, and then go to the examples. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
